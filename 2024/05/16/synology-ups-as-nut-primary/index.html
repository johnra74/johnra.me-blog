<!DOCTYPE html>
<html lang="en-US">
<head>
	<title>Synology + UPS as NUT Primary &#8211; J O H N R A . M E</title>
<meta name="robots" content="max-image-preview:large">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="template" content="Ignite 1.82">
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="alternate" type="application/rss+xml" title="J O H N R A . M E &raquo; Feed" href="/feed/">
<link rel="alternate" type="application/rss+xml" title="J O H N R A . M E &raquo; Comments Feed" href="/comments/feed/">
<script type="text/javascript">
/* <![CDATA[ */
window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.0.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.0.3\/svg\/","svgExt":".svg","source":{"concatemoji":"\/wp-includes\/js\/wp-emoji-release.min.js?ver=6.5.3"}};
/*! This file is auto-generated */
!function(i,n){var o,s,e;function c(e){try{var t={supportTests:e,timestamp:(new Date).valueOf()};sessionStorage.setItem(o,JSON.stringify(t))}catch(e){}}function p(e,t,n){e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(t,0,0);var t=new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data),r=(e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(n,0,0),new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data));return t.every(function(e,t){return e===r[t]})}function u(e,t,n){switch(t){case"flag":return n(e,"🏳️‍⚧️","🏳️​⚧️")?!1:!n(e,"🇺🇳","🇺​🇳")&&!n(e,"🏴󠁧󠁢󠁥󠁮󠁧󠁿","🏴​󠁧​󠁢​󠁥​󠁮​󠁧​󠁿");case"emoji":return!n(e,"🐦‍⬛","🐦​⬛")}return!1}function f(e,t,n){var r="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?new OffscreenCanvas(300,150):i.createElement("canvas"),a=r.getContext("2d",{willReadFrequently:!0}),o=(a.textBaseline="top",a.font="600 32px Arial",{});return e.forEach(function(e){o[e]=t(a,e,n)}),o}function t(e){var t=i.createElement("script");t.src=e,t.defer=!0,i.head.appendChild(t)}"undefined"!=typeof Promise&&(o="wpEmojiSettingsSupports",s=["flag","emoji"],n.supports={everything:!0,everythingExceptFlag:!0},e=new Promise(function(e){i.addEventListener("DOMContentLoaded",e,{once:!0})}),new Promise(function(t){var n=function(){try{var e=JSON.parse(sessionStorage.getItem(o));if("object"==typeof e&&"number"==typeof e.timestamp&&(new Date).valueOf()<e.timestamp+604800&&"object"==typeof e.supportTests)return e.supportTests}catch(e){}return null}();if(!n){if("undefined"!=typeof Worker&&"undefined"!=typeof OffscreenCanvas&&"undefined"!=typeof URL&&URL.createObjectURL&&"undefined"!=typeof Blob)try{var e="postMessage("+f.toString()+"("+[JSON.stringify(s),u.toString(),p.toString()].join(",")+"));",r=new Blob([e],{type:"text/javascript"}),a=new Worker(URL.createObjectURL(r),{name:"wpTestEmojiSupports"});return void(a.onmessage=function(e){c(n=e.data),a.terminate(),t(n)})}catch(e){}c(n=f(s,u,p))}t(n)}).then(function(e){for(var t in e)n.supports[t]=e[t],n.supports.everything=n.supports.everything&&n.supports[t],"flag"!==t&&(n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&n.supports[t]);n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&!n.supports.flag,n.DOMReady=!1,n.readyCallback=function(){n.DOMReady=!0}}).then(function(){return e}).then(function(){var e;n.supports.everything||(n.readyCallback(),(e=n.source||{}).concatemoji?t(e.concatemoji):e.wpemoji&&e.twemoji&&(t(e.twemoji),t(e.wpemoji)))}))}((window,document),window._wpemojiSettings);
/* ]]> */
</script>
<style id="wp-emoji-styles-inline-css" type="text/css">img.wp-smiley, img.emoji {
		display: inline !important;
		border: none !important;
		box-shadow: none !important;
		height: 1em !important;
		width: 1em !important;
		margin: 0 0.07em !important;
		vertical-align: -0.1em !important;
		background: none !important;
		padding: 0 !important;
	}</style>
<link rel="stylesheet" id="wp-block-library-css" href="/wp-includes/css/dist/block-library/style.min.css?ver=6.5.3" type="text/css" media="all">
<style id="classic-theme-styles-inline-css" type="text/css">/*! This file is auto-generated */
.wp-block-button__link{color:#fff;background-color:#32373c;border-radius:9999px;box-shadow:none;text-decoration:none;padding:calc(.667em + 2px) calc(1.333em + 2px);font-size:1.125em}.wp-block-file__button{background:#32373c;color:#fff;text-decoration:none}</style>
<style id="global-styles-inline-css" type="text/css">body{--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 21px;--wp--preset--font-size--x-large: 42px;--wp--preset--font-size--regular: 16px;--wp--preset--font-size--larger: 36px;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgba(255, 255, 255, 1), 6px 6px rgba(0, 0, 0, 1);--wp--preset--shadow--crisp: 6px 6px 0px rgba(0, 0, 0, 1);}:where(.is-layout-flex){gap: 0.5em;}:where(.is-layout-grid){gap: 0.5em;}body .is-layout-flex{display: flex;}body .is-layout-flex{flex-wrap: wrap;align-items: center;}body .is-layout-flex > *{margin: 0;}body .is-layout-grid{display: grid;}body .is-layout-grid > *{margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
.wp-block-navigation a:where(:not(.wp-element-button)){color: inherit;}
:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}
.wp-block-pullquote{font-size: 1.5em;line-height: 1.6;}</style>
<link rel="stylesheet" id="ct-ignite-google-fonts-css" href="//fonts.googleapis.com/css?family=Roboto+Slab%3AThin%2CLight%2CRegular%2CBold&#038;subset=latin%2Clatin-ext&#038;ver=6.5.3" type="text/css" media="all">
<link rel="stylesheet" id="ct-ignite-font-awesome-css" href="/wp-content/themes/ignite/assets/font-awesome/css/all.min.css?ver=6.5.3" type="text/css" media="all">
<link rel="stylesheet" id="ct-ignite-style-css" href="/wp-content/themes/ignite/style.css?ver=6.5.3" type="text/css" media="all">
<style id="ct-ignite-style-inline-css" type="text/css">li.linkcat {
	list-style-type: none;
}

            body, h1, h2, h3, h4, h5, h6, input:not([type='checkbox']):not([type='radio']):not([type='submit']):not([type='file']), input[type='submit'], textarea {
                font-family: Roboto Slab;
                font-style: normal;
                font-weight: ;
            }
        

            .overflow-container {
                background: ;
            }
            .main, .sidebar-primary-container, .breadcrumb-trail {
                background: none;
            }</style>
<script type="text/javascript" src="/wp-includes/js/jquery/jquery.min.js?ver=3.7.1" id="jquery-core-js"></script>
<script type="text/javascript" src="/wp-includes/js/jquery/jquery-migrate.min.js?ver=3.4.1" id="jquery-migrate-js"></script>
<link rel="https://api.w.org/" href="/wp-json/">
<link rel="alternate" type="application/json" href="/wp-json/wp/v2/posts/632">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd">
<meta name="generator" content="WordPress 6.5.3">
<link rel="canonical" href="/2024/05/16/synology-ups-as-nut-primary/">
<link rel="shortlink" href="/?p=632">
<link rel="alternate" type="application/json+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2F%2F2024%2F05%2F16%2Fsynology-ups-as-nut-primary%2F">
<link rel="alternate" type="text/xml+oembed" href="/wp-json/oembed/1.0/embed?url=http%3A%2F%2F%2F2024%2F05%2F16%2Fsynology-ups-as-nut-primary%2F#038;format=xml">
		<style type="text/css" id="wp-custom-css">li.linkcat {
	list-style-type: none;
}</style>
		</head>
<body id="ignite" class="post-template-default single single-post postid-632 single-format-standard singular singular-post singular-post-632">
		<a class="skip-content" href="#main">Skip to content</a>
		<header class="site-header" id="site-header" role="banner">
		<div id="title-info" class="title-info">
			<div class="site-title"><a href="/">J O H N R A . M E</a></div>		</div>
		<button id="toggle-navigation" class="toggle-navigation"><i class="fas fa-bars"></i></button>
<div class="menu-container menu-primary" id="menu-primary" role="navigation">
	<p id="site-description" class="tagline">...yet another musings of a techie</p>
<ul id="menu-primary-items" class="menu-primary-items">
<li id="menu-item-489" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-489"><a href="/">Blog</a></li>
<li id="menu-item-490" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-490"><a href="/about-me/">About</a></li>
<li id="menu-item-522" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-522"><a href="/resume/">Résumé</a></li>
</ul>
<ul class="social-media-icons">				<li>
					<a class="facebook" target="_blank" href="https://www.facebook.com/jra75">
						<i class="fab fa-facebook-square" title="facebook"></i>
						<span class="screen-reader-text">facebook</span>
					</a>
				</li>
								<li>
					<a class="linkedin" target="_blank" href="https://www.linkedin.com/in/johnathan-ra-49b2713">
						<i class="fab fa-linkedin" title="linkedin"></i>
						<span class="screen-reader-text">linkedin</span>
					</a>
				</li>
								<li>
					<a class="youtube" target="_blank" href="https://www.youtube.com/channel/UCYAOIaObT9lzSpnDAy0g0Ng">
						<i class="fab fa-youtube-square" title="youtube"></i>
						<span class="screen-reader-text">youtube</span>
					</a>
				</li>
								<li>
					<a class="github" target="_blank" href="https://github.com/johnra74">
						<i class="fab fa-github-square" title="github"></i>
						<span class="screen-reader-text">github</span>
					</a>
				</li>
				</ul>
</div>	</header>
		<div id="overflow-container" class="overflow-container">
		<div id="breadcrumbs" class="breadcrumb-trail breadcrumbs">
<span class="item-home"><a class="bread-link bread-home" href="/" title="Home">Home</a></span><span class="separator"> &gt; </span><span class="item-cat"><a href="/category/tutorial/">Tutorial</a></span><span class="separator"> &gt; </span><span class="item-current item-632"><span class="bread-current bread-632" title="Synology + UPS as NUT Primary">Synology + UPS as NUT Primary</span></span>
</div>		<div id="main" class="main" role="main">	<div id="loop-container" class="loop-container">
			<div class="post-632 post type-post status-publish format-standard has-post-thumbnail hentry category-tutorial tag-nut tag-synology tag-ups entry">
		<div class="featured-image"><img width="895" height="466" src="/wp-content/uploads/2024/05/ups.png" class="attachment-full size-full wp-post-image" alt="" decoding="async" fetchpriority="high" srcset="/wp-content/uploads/2024/05/ups.png 895w, /wp-content/uploads/2024/05/ups-300x156.png 300w, /wp-content/uploads/2024/05/ups-768x400.png 768w" sizes="(max-width: 895px) 100vw, 895px"></div>			<div class="entry-meta-top">
		Published May 16, 2024 by <a href="/author/johnra/" title="Posts by John Ra" rel="author">John Ra</a>	</div>
		<div class="entry-header">
			<h1 class="entry-title">Synology + UPS as NUT Primary</h1>
		</div>
		<div class="entry-content">
			<article>
								
<p>I recently purchased a CyberPower CST135XLU Uninterruptible Power Supply (UPS) for my linux server, Orbi Wifi Router, and  Synology NAS. However, I only need my Orbi running on UPS in the event of a power outage; the others don&#8217;t need to be running. With my Fios on a dedicated UPS and Orbi on this new UPS, I will be able to stay on line while I wait for the power to be restored. This means I need to setup Network UPS Tools (NUT) so that I can gracefully shutdown my Synology NAS and linux server &#8211; giving my Orbi extended uptime on UPS battery mode. </p>



<h3 class="wp-block-heading">Options</h3>



<p>I can either attach the UPS to my linux server with NUT as primary then setup Synology NAS as secondary. Or, reverse it with Synology NAS as primary with linux as secondary. There are many other factors but, ultimately, primary has to stay up longer than secondary to avoid unexpected behavior caused by loss of communication to primary. Additionally, given that my linux server consumes more raw power than my Synology, it was an obvious decision to make Synology my primary.</p>



<h3 class="wp-block-heading">Synology UPS Setup</h3>



<p>To setup local UPS support, connect the UPS device to a USB port of the Synology NAS. Login to your DSM and navigate to &#8220;Control Panel&#8221; then click &#8220;Hardware &amp; Power&#8221;. Under the UPS tab, &#8220;Enable UPS support&#8221; and select &#8220;USB UPS&#8221;. In my case, I want to gracefully shutdown after 5 minutes &#8211; not have it running &#8220;Until low battery&#8221;</p>



<figure class="wp-block-image size-full"><img decoding="async" width="585" height="463" src="/wp-content/uploads/2024/05/image.png" alt="" class="wp-image-635" srcset="/wp-content/uploads/2024/05/image.png 585w, /wp-content/uploads/2024/05/image-300x237.png 300w" sizes="(max-width: 585px) 100vw, 585px"></figure>



<p>Tick &#8220;Enable network UPS server&#8221; to allow NUT client to connect to this service as secondary. Click &#8220;Permitted DiskStation Devices&#8221; and enter the client IP address &#8211; in my case, this would be my linux server&#8217;s fixed IP address.</p>



<figure class="wp-block-image size-full"><img decoding="async" width="530" height="270" src="/wp-content/uploads/2024/05/image-1.png" alt="" class="wp-image-636" srcset="/wp-content/uploads/2024/05/image-1.png 530w, /wp-content/uploads/2024/05/image-1-300x153.png 300w" sizes="(max-width: 530px) 100vw, 530px"></figure>



<p>Click &#8220;OK&#8221; then click &#8220;Apply&#8221;. You now have NUT service running on Synology as primary. </p>



<h4 class="wp-block-heading">Extract Required NUT client details</h4>



<p>To access required data to properly configure NUT client, you must login to DSM via terminal over SSH. From DSM, go to &#8220;Control Panel&#8221; and click &#8220;Terminal &amp; SNMP&#8221;. Under &#8220;Terminal&#8221; tab, tick &#8220;Enable SSH service&#8221;. </p>



<p>SSH into DSM as user with administrative role. Once logged in, run <code>sudo tail /etc/ups/upsd.users</code> command. Look for the line <code>password = &lt;password&gt;</code>, note this password down. Prior to the password line, note down the username defined within square brackets ([monuser]). Then, run <code>sudo tail /etc/ups/ups.conf</code>. The name within square braces is the UPS name. See green outline in screenshot</p>



<figure class="wp-block-image size-full"><img loading="lazy" decoding="async" width="979" height="631" src="/wp-content/uploads/2024/05/console.png" alt="" class="wp-image-641" srcset="/wp-content/uploads/2024/05/console.png 979w, /wp-content/uploads/2024/05/console-300x193.png 300w, /wp-content/uploads/2024/05/console-768x495.png 768w" sizes="(max-width: 979px) 100vw, 979px"></figure>



<p></p>



<h3 class="wp-block-heading">Linux Server Setup as NUT client</h3>



<h4 class="wp-block-heading">Pre-requisite</h4>



<p>First install Network UPS Tools &#8211; if not already installed</p>



<pre class="wp-block-code"><code>$ sudo apt update
$ sudo apt install nut</code></pre>



<h4 class="wp-block-heading">Setup NUT Monitor</h4>



<p>First, configure NUT as netclient by editing <code>/var/nut/nut.conf</code>. Look for MODE and change it to netclient</p>



<pre class="wp-block-code"><code>MODE=netclient</code></pre>



<p>Then, edit <code>/etc/nut/upsmon.conf</code>  to add MONITOR line with the name capture from ups.conf along with the monitor user (e.g. monuser) and password from upsd.user from above Synology section. </p>



<pre class="wp-block-code"><code>MONITOR &lt;name from ups.conf on synology&gt;@&lt;ip address of your synology&gt; 1 &lt;monitor user from above&gt; &lt;password from above&gt; slave</code></pre>



<p>Then setup NOTIFYFLAG. If NOTIFYFLAG are commented out, please add the follow. Otherwise, edit them according. </p>



<pre class="wp-block-code"><code>NOTIFYFLAG ONLINE     SYSLOG+EXEC
NOTIFYFLAG ONBATT     SYSLOG+EXEC
NOTIFYFLAG LOWBATT    SYSLOG+EXEC
NOTIFYFLAG FSD        SYSLOG+WALL+EXEC
NOTIFYFLAG COMMOK     SYSLOG+EXEC
NOTIFYFLAG COMMBAD    SYSLOG+EXEC
NOTIFYFLAG SHUTDOWN   SYSLOG+WALL+EXEC
NOTIFYFLAG REPLBATT   SYSLOG+WALL+EXEC
NOTIFYFLAG NOCOMM     SYSLOG+WALL+EXEC
NOTIFYFLAG NOPARENT   SYSLOG+WALL+EXEC</code></pre>



<p>The SYSLOG will trigger logging. WALL will send message to all terminal sessions. The EXEC command will trigger script defined by NOTIFYCMD. This will be further discussed in next section. </p>



<pre class="wp-block-code"><code>NOTIFYCMD /usr/sbin/upssched</code></pre>



<p>This will enable NUT to monitor your UPS status on Synology and notify and/or execute action</p>



<h4 class="wp-block-heading">Setup NUT Schedule</h4>



<p>When UPS notification occurs, NOTIFYFLAG is used to perform actions for a given notification type. For example, when UPS moves to battery mode, ONBATT will be triggered. In the above case,  It will perform SYSLOG which will log to <code>/var/log/syslog</code> and EXEC will trigger the script defined by NOTIFYCMD. When power is restored to UPS, ONLINE will be trigger. </p>



<p>Edit <code>/etc/nut/upssched.conf</code> uncomment the following line. This sets the file name of the First In First Out (FIFO) between processes to start and stop timer.</p>



<pre class="wp-block-code"><code>PIPEFN /run/nut/upssched/upssched.pipe</code></pre>



<p>Then uncomment the following line. This will prevent race condition.</p>



<pre class="wp-block-code"><code>LOCKFN /run/nut/upssched/upssched.lock</code></pre>



<p>Add the following commands</p>



<pre class="wp-block-code"><code>AT ONLINE * EXECUTE online
AT ONBATT * EXECUTE onbatt</code></pre>



<p>Search for CMDSCRIPT and edit the file referenced (e.g. <code>/bin/upssched-cmd</code>). Replace with following:</p>



<pre class="wp-block-code"><code>#! /bin/sh
#
# This script should be called by upssched via the CMDSCRIPT directive.
#
# Here is a quick example to show how to handle a bunch of possible
# timer names with the help of the case structure.
#
# This script may be replaced with another program without harm.
#
# The first argument passed to your CMDSCRIPT is the name of the timer
# from your AT lines.

UPS="&lt;name from ups.conf on synology&gt;@&lt;ip address of your synology&gt;"

STATUS=$( upsc $UPS ups.status )
CHARGE=$( upsc $UPS battery.charge )
CHMSG="&#091;$STATUS]:$CHARGE%"

case $1 in
        online)
                MSG="$UPS, $CHMSG - power supply has been restored."
                /sbin/shutdown -c
                ;;
        onbatt)
                MSG="$UPS, $CHMSG - power failure - save your work!"
                /sbin/shutdown -h +2
                ;;
        lowbatt)
                MSG="$UPS, $CHMSG - shutdown now!"
                /sbin/shutdown -h now
                ;;
        upsgone) MSG="The UPS $UPS has been gone for awhile" ;;
        *) MSG="$UPS, $CHMSG - Unrecognized command: $1" ;;
esac
logger -i -t upssched-cmd $MSG</code></pre>



<p>In above example, when NOTIFYFLAG ONBATT occurs, it will execute <code>/usr/sbin/upssched</code> defined by NOTIFYCMD. This will trigger <code>AT ONLINE * EXECUTE online</code> which will call <code>/bin/upssched-cmd</code> defined by CMDSCRIPT. In <code>/bin/upssched-cmd</code> onbatt case will result execute shutdown in 2 minutes (see <code>/sbin/shutdown -h +2</code>). However, when power is restored, the online trigger will cancel the shutdown (see <code>/sbin/shutdown -c</code>).</p>



<h4 class="wp-block-heading">Restart NUT Monitor</h4>



<p>Reload NUT monitor with the latest changes by executing following commands</p>



<pre class="wp-block-code"><code>$ sudo service nut-monitor stop
$ sudo service nut-monitor start</code></pre>



<p>To test, unplug your battery from power source to trigger ONBATT notification then plug it back in. If everything is setup correctly, you should see in the <code>/var/log/syslog</code> similar to below. </p>



<figure class="wp-block-image size-large"><img loading="lazy" decoding="async" width="1024" height="186" src="/wp-content/uploads/2024/05/console-1-1024x186.png" alt="" class="wp-image-646" srcset="/wp-content/uploads/2024/05/console-1-1024x186.png 1024w, /wp-content/uploads/2024/05/console-1-300x55.png 300w, /wp-content/uploads/2024/05/console-1-768x140.png 768w, /wp-content/uploads/2024/05/console-1.png 1056w" sizes="(max-width: 1024px) 100vw, 1024px"></figure>
							</article>
		</div>
		<div class="entry-meta-bottom">
			<nav class="further-reading">
	<p class="prev">
		<span>Previous Post</span>
		<a href="/2024/04/10/context-matters/">Context Matters</a>
	</p>
	<p class="next">
		<span>No Newer Posts</span>
		<a href="/">Return to Blog</a>
	</p>
</nav>			<div class="author-meta">
	<img alt="John Ra" src="http://0.gravatar.com/avatar/9cf78ef0cb8ec76b55c0045c4aa1f183?s=72&#038;d=mm&#038;r=g" srcset="http://0.gravatar.com/avatar/9cf78ef0cb8ec76b55c0045c4aa1f183?s=144&#038;d=mm&#038;r=g 2x" class="avatar avatar-72 photo" height="72" width="72" loading="lazy" decoding="async">	<div class="name-container">
		<h4>
			John Ra		</h4>
	</div>
	<p>
			</p>
</div>			<div class="entry-categories"><p><i class="fas fa-folder-open"></i><a href="/category/tutorial/" title="View all posts in Tutorial">Tutorial</a></p></div>			<div class="entry-tags"><p><i class="fas fa-tag"></i><a href="/tag/nut/" title="View all posts tagged NUT">NUT</a> <a href="/tag/synology/" title="View all posts tagged Synology">Synology</a> <a href="/tag/ups/" title="View all posts tagged UPS">UPS</a></p></div>		</div>
	</div>
		</div>
</div>
<!-- .main -->
	<aside id="sidebar-primary-container" class="sidebar-primary-container">
		<h1 class="screen-reader-text">Primary Sidebar</h1>
		<div class="sidebar sidebar-primary" id="sidebar-primary" role="complementary">
			<section id="block-3" class="widget widget_block">
<div class="wp-block-group"><div class="wp-block-group__inner-container is-layout-flow wp-block-group-is-layout-flow">
<h2 class="wp-block-heading">Recent Posts</h2>


<ul class="wp-block-latest-posts__list wp-block-latest-posts">
<li><a class="wp-block-latest-posts__post-title" href="/2024/05/16/synology-ups-as-nut-primary/">Synology + UPS as NUT Primary</a></li>
<li><a class="wp-block-latest-posts__post-title" href="/2024/04/10/context-matters/">Context Matters</a></li>
<li><a class="wp-block-latest-posts__post-title" href="/2022/03/29/its-a-trap/">It&#8217;s a trap!</a></li>
<li><a class="wp-block-latest-posts__post-title" href="/2022/02/02/7-minute-abs/">7-Minute Abs</a></li>
<li><a class="wp-block-latest-posts__post-title" href="/2022/01/23/restart/">I&#8217;m Back?</a></li>
</ul>
</div></div>
</section><section id="block-19" class="widget widget_block">
<div class="wp-block-group"><div class="wp-block-group__inner-container is-layout-flow wp-block-group-is-layout-flow">
<p></p>
<li id="linkcat-8" class="linkcat">
<h2>Favorite Blogs</h2>
	<ul class="xoxo blogroll">
<li><a href="http://blog.activelylazy.co.uk/">Actively Lazy</a></li>
<li><a href="http://www.codeofhonor.com/blog/">Code Of Honor</a></li>
<li><a href="http://www.codinghorror.com/blog/">Coding Horror</a></li>
<li><a href="http://blog.sanaulla.info/">Experiences Unlimited</a></li>
<li><a href="http://javadepend.wordpress.com/">JArchitect</a></li>
<li><a href="http://www.markhneedham.com/blog/">Mark Needham</a></li>
<li><a href="https://msun.io/" rel="friend colleague">Mike Sun</a></li>
<li><a href="http://blogs.msdn.com/b/oldnewthing/">Old New Thing</a></li>
<li><a href="http://www.opsbs.com/">Operation Bootstrap</a></li>
<li><a href="http://blog.schauderhaft.de/">Schauderhaft</a></li>
<li><a href="http://www.hanselman.com/blog/">Scott Hanselman</a></li>
<li><a href="http://simpleprogrammer.com/">Simple Programmer</a></li>

	</ul>
</li>
<li id="linkcat-11" class="linkcat">
<h2>Favorite Sites</h2>
	<ul class="xoxo blogroll">
<li><a href="http://www.dotnetcodegeeks.com/">.NET Code Geeks</a></li>
<li><a href="http://www.dzone.com/">DZone</a></li>
<li><a href="http://www.gizmodo.com/">Gizmodo</a></li>
<li><a href="http://www.javacodegeeks.com/">Java Code Geeks</a></li>
<li><a href="http://www.slashdot.com/">Slashdot</a></li>
<li><a href="http://www.theregister.co.uk/">The Register</a></li>
<li><a href="http://www.theserverside.com/">The Serverside</a></li>

	</ul>
</li>

</div></div>
</section><section id="block-4" class="widget widget_block">
<div class="wp-block-group"><div class="wp-block-group__inner-container is-layout-flow wp-block-group-is-layout-flow">
<h2 class="wp-block-heading">Categories</h2>


<ul class="wp-block-categories-list wp-block-categories">	<li class="cat-item cat-item-9">
<a href="/category/dotnet/">.NET</a>
</li>
	<li class="cat-item cat-item-18">
<a href="/category/dotnet/aspnet/">ASP.NET</a>
</li>
	<li class="cat-item cat-item-4">
<a href="/category/dotnet/csharp/">C#</a>
</li>
	<li class="cat-item cat-item-34">
<a href="/category/java/gradle/">Gradle</a>
</li>
	<li class="cat-item cat-item-29">
<a href="/category/java/groovy/">Groovy</a>
</li>
	<li class="cat-item cat-item-25">
<a href="/category/humor/">Humor</a>
</li>
	<li class="cat-item cat-item-17">
<a href="/category/iis/">IIS</a>
</li>
	<li class="cat-item cat-item-26">
<a href="/category/ios/">iOS</a>
</li>
	<li class="cat-item cat-item-3">
<a href="/category/java/">Java</a>
</li>
	<li class="cat-item cat-item-22">
<a href="/category/jscript/">JavaScript</a>
</li>
	<li class="cat-item cat-item-23">
<a href="/category/jscript/jquery/">jQuery</a>
</li>
	<li class="cat-item cat-item-32">
<a href="/category/opensource/">Open Source</a>
</li>
	<li class="cat-item cat-item-33">
<a href="/category/patterns/">Patterns</a>
</li>
	<li class="cat-item cat-item-6">
<a href="/category/rant/">Rants</a>
</li>
	<li class="cat-item cat-item-5">
<a href="/category/tutorial/">Tutorial</a>
</li>
	<li class="cat-item cat-item-1">
<a href="/category/uncategorized/">Uncategorized</a>
</li>
</ul>
</div></div>
</section>		</div>
	</aside>
</div>
<!-- .overflow-container -->
<footer id="site-footer" class="site-footer" role="contentinfo">
	<h1>
		<a href="/">
			J O H N R A . M E		</a>
	</h1>
	<span class="tagline">...yet another musings of a techie</span>	<div class="design-credit">
        <span>
             &nbsp;        </span>
	</div>
	<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-0170985620077101" crossorigin="anonymous"></script>
	<!-- BlogFooter -->
	<ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-0170985620077101" data-ad-slot="8538453118" data-ad-format="auto" data-full-width-responsive="true"></ins>
	<script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
</footer>
<script type="text/javascript" src="/wp-content/themes/ignite/js/build/production.min.js?ver=6.5.3" id="ct-ignite-production-js"></script>
</body>
</html>